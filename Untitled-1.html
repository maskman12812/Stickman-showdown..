<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stickman Showdown</title>
    <style>
        body { margin: 0; background: #222; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; font-family: sans-serif; overflow: hidden; }
        canvas { background: #eee; border: 4px solid #555; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        h1 { color: white; margin-bottom: 10px; }
        .controls { color: #aaa; margin-top: 10px; font-size: 0.8rem; }
    </style>
</head>
<body>

    <h1>Stickman Showdown</h1>
    <canvas id="gameCanvas"></canvas>
    <div class="controls">P1: WASD + Space | P2: Arrows + Enter</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

canvas.width = 800;
canvas.height = 400;

const gravity = 0.8;

class Stickman {
    constructor(x, color, controls, side) {
        this.x = x;
        this.y = 300;
        this.width = 30;
        this.height = 60;
        this.color = color;
        this.controls = controls;
        this.side = side; // 1 for right, -1 for left
        
        this.velX = 0;
        this.velY = 0;
        this.speed = 5;
        this.jumpStrength = -15;
        this.isJumping = false;
        
        this.health = 100;
        this.attacking = false;
        this.attackCooldown = false;
    }

    draw() {
        ctx.strokeStyle = this.color;
        ctx.lineWidth = 4;
        ctx.beginPath();

        // Head
        ctx.arc(this.x, this.y - 40, 10, 0, Math.PI * 2);
        // Body
        ctx.moveTo(this.x, this.y - 30);
        ctx.lineTo(this.x, this.y);
        // Legs
        ctx.moveTo(this.x, this.y);
        ctx.lineTo(this.x - 10, this.y + 20);
        ctx.moveTo(this.x, this.y);
        ctx.lineTo(this.x + 10, this.y + 20);
        // Arms
        if (this.attacking) {
            ctx.moveTo(this.x, this.y - 20);
            ctx.lineTo(this.x + (25 * this.side), this.y - 25); // Punching arm
        } else {
            ctx.moveTo(this.x, this.y - 20);
            ctx.lineTo(this.x - 15, this.y - 5);
            ctx.moveTo(this.x, this.y - 20);
            ctx.lineTo(this.x + 15, this.y - 5);
        }
        
        ctx.stroke();

        // Health Bar UI
        ctx.fillStyle = 'red';
        let barX = (this.side === 1) ? 20 : canvas.width - 120;
        ctx.fillRect(barX, 20, 100, 10);
        ctx.fillStyle = 'lime';
        ctx.fillRect(barX, 20, this.health, 10);
    }

    update(opponent) {
        // Movement
        if (keys[this.controls.left]) this.velX = -this.speed;
        else if (keys[this.controls.right]) this.velX = this.speed;
        else this.velX = 0;

        if (keys[this.controls.up] && !this.isJumping) {
            this.velY = this.jumpStrength;
            this.isJumping = true;
        }

        // Attack Logic
        if (keys[this.controls.attack] && !this.attackCooldown) {
            this.attacking = true;
            this.attackCooldown = true;
            
            // Hit Detection
            const reach = 30;
            const hit = (this.side === 1) 
                ? (this.x + reach > opponent.x - 10 && this.x < opponent.x)
                : (this.x - reach < opponent.x + 10 && this.x > opponent.x);

            if (hit && Math.abs(this.y - opponent.y) < 40) {
                opponent.health -= 10;
                opponent.velX = 10 * this.side; // Knockback
            }

            setTimeout(() => { this.attacking = false; }, 150);
            setTimeout(() => { this.attackCooldown = false; }, 400);
        }

        // Physics
        this.y += this.velY;
        this.x += this.velX;
        this.velY += gravity;

        // Ground Collision
        if (this.y > 350) {
            this.y = 350;
            this.velY = 0;
            this.isJumping = false;
        }

        // Keep in bounds
        if (this.x < 10) this.x = 10;
        if (this.x > canvas.width - 10) this.x = canvas.width - 10;

        // Face the opponent
        this.side = (this.x < opponent.x) ? 1 : -1;

        this.draw();
    }
}

const keys = {};
window.addEventListener('keydown', e => keys[e.code] = true);
window.addEventListener('keyup', e => keys[e.code] = false);

const p1 = new Stickman(100, 'blue', {left:'KeyA', right:'KeyD', up:'KeyW', attack:'Space'}, 1);
const p2 = new Stickman(700, 'red', {left:'ArrowLeft', right:'ArrowRight', up:'ArrowUp', attack:'Enter'}, -1);

function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Floor
    ctx.strokeStyle = '#555';
    ctx.beginPath(); ctx.moveTo(0, 372); ctx.lineTo(800, 372); ctx.stroke();

    p1.update(p2);
    p2.update(p1);

    if (p1.health <= 0 || p2.health <= 0) {
        ctx.fillStyle = 'black';
        ctx.font = '40px Arial';
        ctx.fillText(p1.health <= 0 ? "RED WINS!" : "BLUE WINS!", 280, 200);
        return; // Stop game
    }

    requestAnimationFrame(animate);
}

animate();
</script>
</body>
</html>